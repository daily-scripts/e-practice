{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _slicedToArray from\"/Users/xuel/workspace/GitHub/programmer-english/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useCallback,useLayoutEffect}from'react';import Letter from'./Letter';import{isLegal,isChineseSymbol}from'../../utils/utils';import useSounds from'hooks/useSounds';import style from'./index.module.css';import WordSound from'components/WordSound';import{useAppState}from'../../store/AppState';var EXPLICIT_SPACE='␣';var Word=function Word(_ref){var _ref$word=_ref.word,word=_ref$word===void 0?'defaultWord':_ref$word,onFinish=_ref.onFinish,isStart=_ref.isStart,_ref$wordVisible=_ref.wordVisible,wordVisible=_ref$wordVisible===void 0?true:_ref$wordVisible;var originWord=word;word=word.replace(new RegExp(' ','g'),EXPLICIT_SPACE);word=word.replace(new RegExp('…','g'),'..');var _useState=useState(''),_useState2=_slicedToArray(_useState,2),inputWord=_useState2[0],setInputWord=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),statesList=_useState4[0],setStatesList=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isFinish=_useState6[0],setIsFinish=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),hasWrong=_useState8[0],setHasWrong=_useState8[1];var _useSounds=useSounds(),_useSounds2=_slicedToArray(_useSounds,3),playKeySound=_useSounds2[0],playBeepSound=_useSounds2[1],playHintSound=_useSounds2[2];var _useAppState=useAppState(),pronunciation=_useAppState.pronunciation;var onKeydown=useCallback(function(e){var char=e.key;if(char===' '){// 防止用户惯性按空格导致页面跳动\ne.preventDefault();setInputWord(function(value){return value+=EXPLICIT_SPACE;});playKeySound();}if(isChineseSymbol(char)){alert('您正在使用中文输入法输入，请关闭输入法');}if(isLegal(char)&&!e.altKey&&!e.ctrlKey&&!e.metaKey){setInputWord(function(value){return value+=char;});playKeySound();}else if(char==='Backspace')setInputWord(function(value){return value.substr(0,value.length-1);});},[playKeySound]);useEffect(function(){if(isStart&&!isFinish)window.addEventListener('keydown',onKeydown);return function(){window.removeEventListener('keydown',onKeydown);};},[isStart,isFinish,onKeydown]);useEffect(function(){if(isFinish){playHintSound();onFinish();}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[isFinish,hasWrong,playHintSound]);useEffect(function(){if(hasWrong){playBeepSound();var timer=setTimeout(function(){setInputWord('');setHasWrong(false);},300);return function(){clearTimeout(timer);};}},[hasWrong,isFinish,playBeepSound]);useLayoutEffect(function(){var hasWrong=false,wordLength=word.length,inputWordLength=inputWord.length;var statesList=[];for(var i=0;i<wordLength&&i<inputWordLength;i++){if(word[i]===inputWord[i]){statesList.push('correct');}else{hasWrong=true;statesList.push('wrong');setHasWrong(true);break;}}if(!hasWrong&&inputWordLength>=wordLength){setIsFinish(true);}setStatesList(statesList);},[inputWord,word]);var playWordSound=pronunciation!==false;return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center pt-4 pb-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center \".concat(hasWrong?style.wrong:''),children:word.split('').map(function(t,index){return/*#__PURE__*/_jsx(Letter,{visible:statesList[index]==='correct'?true:wordVisible,letter:t,state:statesList[index]},\"\".concat(index,\"-\").concat(t));})}),playWordSound&&/*#__PURE__*/_jsx(WordSound,{word:originWord,inputWord:inputWord,className:\"\".concat(style['word-sound'])})]})});};export default Word;","map":null,"metadata":{},"sourceType":"module"}